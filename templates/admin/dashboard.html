<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
  <!-- Stats Cards -->
  <div>
    <h3>Users</h3>
    <div id="users-stats"></div>
  </div>
  
  <div>
    <h3>Community</h3>
    <div id="community-stats"></div>
  </div>
  
  <div>
    <h3>Courses</h3>
    <div id="courses-stats"></div>
  </div>
  
  <div>
    <h3>Revenue</h3>
    <div id="revenue-stats"></div>
  </div>
  
  <!-- Charts -->
  <div>
    <h3>User Growth (30 days)</h3>
    <canvas id="userGrowthChart" style="max-height: 300px;"></canvas>
  </div>
  
  <div>
    <h3>Revenue Trend (30 days)</h3>
    <canvas id="revenueTrendChart" style="max-height: 300px;"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const statsData = {{ dashboard_stats_json|safe }};
  
  // Display stats
  function displayStats() {
    // Users
    document.getElementById('users-stats').innerHTML = `
      <p>Total: ${statsData.users.total}</p>
      <p>Active: ${statsData.users.active}</p>
      <p>Facilitators: ${statsData.users.facilitators}</p>
      <p>Corporate: ${statsData.users.corporate}</p>
    `;
    
    // Community
    document.getElementById('community-stats').innerHTML = `
      <p>Posts: ${statsData.community.posts}</p>
      <p>Comments: ${statsData.community.comments}</p>
      <p>Groups: ${statsData.community.groups}</p>
    `;
    
    // Courses
    document.getElementById('courses-stats').innerHTML = `
      <p>Total: ${statsData.courses.total}</p>
      <p>Published: ${statsData.courses.published}</p>
      <p>Enrollments: ${statsData.courses.enrollments}</p>
    `;
    
    // Revenue
    document.getElementById('revenue-stats').innerHTML = `
      <p>Transactions: ${statsData.revenue.transactions}</p>
      <p>Successful: ${statsData.revenue.successful}</p>
      <p>Revenue: $${statsData.revenue.revenue.toFixed(2)}</p>
      <p>Subscriptions: ${statsData.revenue.subscriptions}</p>
    `;
  }
  
  // Initialize charts
  function initCharts() {
    // User Growth Chart
    const ctx1 = document.getElementById('userGrowthChart');
    if (ctx1 && statsData.user_growth.length > 0) {
      new Chart(ctx1, {
        type: 'line',
        data: {
          labels: statsData.user_growth.map(d => d.date),
          datasets: [{
            label: 'New Users',
            data: statsData.user_growth.map(d => d.count),
            borderColor: '#417690',
            backgroundColor: 'rgba(65, 118, 144, 0.1)',
            tension: 0.1,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: { legend: { display: true } }
        }
      });
    }
    
    // Revenue Trend Chart
    const ctx2 = document.getElementById('revenueTrendChart');
    if (ctx2 && statsData.revenue_trend.length > 0) {
      new Chart(ctx2, {
        type: 'bar',
        data: {
          labels: statsData.revenue_trend.map(d => d.date),
          datasets: [{
            label: 'Daily Revenue',
            data: statsData.revenue_trend.map(d => d.revenue),
            backgroundColor: 'rgba(39, 174, 96, 0.6)',
            borderColor: '#27ae60',
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: { legend: { display: true } }
        }
      });
    }
  }
  
  // Load data
  displayStats();
  initCharts();
  
  // Refresh every 5 minutes
  setInterval(() => {
    fetch('/api/dashboard-stats/')
      .then(r => r.json())
      .then(data => {
        window.statsData = data;
        displayStats();
      });
  }, 300000);
</script>
